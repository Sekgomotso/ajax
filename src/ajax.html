<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewpoint" content="width=device-width, intitial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="ajax.css">

    <title> Visitor form </title>
</head>
<body>

    <h1 class="heading"> Visitor's form </h1>

    <form action="single-page-app" method="POST" id="forms">

        <input type="text" name="visitor_name" placeholder="Visitor name" id="body">
        <br><br>
        <input type="text" name="assistant" placeholder="Assistant" id="body">
        <br><br>
        <input type="text" name="visitors_age" placeholder="Visitor's age" id="body">
        <br><br>
        <input type="text" name="date_of_visit" placeholder="Date of visit" id="body">
        <br><br>
        <input type="text" name="time_of_visit" placeholder="Time of visit" id="body">
        <br><br>
        <input type="text" placeholder="Comments" id="body">
        <br><br>
        <input onclick="addNewVisitor()" type="submit" value="Submit">

    </form>

    <br><br>

    <table id="visitors" width = 700px border ="1">

        <h1>Visitor table</h1>

        <thead>
            <tr>
                <th id=> Id </th>
                <th> Name </th>
                <th> Age </th>
                <th> Date </th>
                <th> Time </th>
                <th> Assistant </th>
                <th> Comments </th>
                <th>&nbsp;</th>
            </tr>
        </thead>

        <tbody id = "content" onclick="viewVisitor()">
            <td>1</td>
            <td>Sekgomotso</td>
            <td>24</td>
            <td>24/09/2020</td>
            <td>10:00</td>
            <td>Neo</td>
            <td>Hi</td>
            <td><button onclick="deleteVisitor()">Delete</button></td>
        </tbody>

    </table>

    <script>

        //add event listener
        document.getElementById("forms").addEventListener("submit", addNewVisitor);
        document.getElementById("forms").addEventListener("submit", viewVisitors);

        const addNewVisitor = async (event) => {

            event.preventDefault();

            let forms = document.getElementById("forms").value;
            let body = document.getElementById("body").value;

            try{

                // submit button
                let data = await fetch ('http://localhost:3009/single-page-app', {
                method:"POST",
                headers:{
                    "Content-type":"application/json"
                },
                mode:'cors',

                // change a json file to a string
                body: JSON.stringify({forms: forms, body:body})
            })
            
            } catch (err) {
                console.log(err)
            }
        };
        
        // populate table
        let array = [];

        fetch('http://localhost:3009/single-page-app', {
            method: 'GET',
            mode:'cors',
            headers:{
                "Content-type":"application/json"
            },

            success: function(response) {
                array = response.data;
                viewVisitors(array);
            }
        })

        function viewVisitors(data) {
            let table = document.getElementById('content');

            for (i = 0; i < data.length; i++) {
                let insert = ` <tr>
                                     <td>${data[i].visitor_id}</td>
                                     <td>${data[i].visitor_name}</td>
                                     <td>${data[i].visitor_age}</td>
                                     <td>${data[i].date_of_visit}</td>
                                     <td>${data[i].time_of_visit}</td>
                                     <td>${data[i].assistant}</td>
                                     <td>${data[i].comment}</td>
                                </tr>`
                                table.innerHTML += insert
            }
        };

        // delete visitor 
        const deleteVisitor = () => {
            if(document.getElementById("body").innerHTML){
                document.getElementById("body").innerHTML ="";
                console.log("user removed from webpage...")
            }
        };

          
    </script>

</body>
    
</html>